<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
        <%= title %>
    </title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <style>
        body {
            background-color: #f8f9fa;
            color: #212529;
            transition: background-color 0.3s, color 0.3s;
        }

        h2 {
            font-weight: bold;
            margin-bottom: 10px;
        }

        .status-btn {
            width: 100%;
            padding: 6px 12px;
            border: none;
            color: white;
            font-size: 14px;
            cursor: pointer;
            border-radius: 8px;
            font-weight: bold;
            transition: background-color 0.3s, transform 0.2s;
        }

        .btn-active {
            background-color: #28a745;
        }

        .btn-inactive {
            background-color: #dc3545;
        }

        .status-btn:hover,
        .btn-danger:hover,
        .btn-warning:hover {
            filter: brightness(1.1);
            transform: scale(1.03);
        }

        .btn-danger,
        .btn-warning {
            border-radius: 6px;
            font-weight: 500;
        }

        .btn-warning {
            color: #000;
        }

        .table {
            table-layout: fixed;
            width: 100%;
        }

        .table th,
        .table td {
            word-wrap: break-word;
            white-space: normal;
            border-width: 1px;
            font-size: 14px;
            vertical-align: middle;
        }

        /* ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå */
        .table th.name,
        .table td.name {
            width: 15%;
        }

        .table th.price,
        .table td.price {
            width: 10%;
        }

        .table th.description,
        .table td.description {
            width: 25%;
        }

        .table th.category,
        .table td.category {
            width: 10%;
        }

        .table th.image,
        .table td.image {
            width: 12%;
        }

        .table th.status,
        .table td.status {
            width: 10%;
        }

        .table th.delete,
        .table td.delete,
        .table th.edit,
        .table td.edit {
            width: 9%;
        }

        .img-thumbnail {
            border-radius: 8px;
            display: block;
            margin-left: auto;
            margin-right: auto;
        }

        .category-section {
            background-color: #fff;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            padding: 20px;
            margin-bottom: 40px;
            transition: background-color 0.3s, color 0.3s;
        }

        .category-section h4 {
            font-weight: bold;
            border-left: 5px solid #0d6efd;
            padding-left: 10px;
        }

        .table td.name,
        .table td.price,
        .table td.description,
        .table td.category,
        .table td.status,
        .table td.delete,
        .table td.edit,
        .table th.name,
        .table th.price,
        .table th.description,
        .table th.category,
        .table th.image,
        .table th.status,
        .table th.delete,
        .table th.edit {
            text-align: center;
            vertical-align: middle;
        }

        /* üåô Dark Mode Styles */
        .dark-mode {
            background-color: #121212;
            color: #f1f1f1;
        }

        .dark-mode .text-muted {
            color: #ffffff !important;
        }

        .dark-mode .category-section {
            background-color: #2a2a2a;
            box-shadow: 0 0 0 1px #444;
        }

        .dark-mode .table {
            background-color: #1c1c1c;
            color: #f1f1f1;
            border-color: #444;
        }

        .dark-mode .table thead th {
            background-color: #2a2a2a;
            color: #ffffff !important;
        }

        .dark-mode .table tbody td {
            background-color: #1c1c1c;
            color: #f1f1f1 !important;
            border-color: #444;
        }

        .dark-mode .table-striped tbody tr:nth-of-type(odd) {
            background-color: #222;
        }

        .dark-mode .table-hover tbody tr:hover {
            background-color: #2e2e2e;
        }
    </style>
</head>

<body>
    <%- include('navbar.ejs') %>

        <div class="container mt-4">
            <h2>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏°‡∏ô‡∏π‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≤‡∏´‡∏≤‡∏£</h2>
            <p class="text-muted">‡πÄ‡∏û‡∏¥‡πà‡∏° ‡∏•‡∏ö ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</p>

            <div class="mb-4 row">
                <div class="col-md-6">
                    <input type="text" id="searchInput" class="form-control" placeholder="üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÄ‡∏°‡∏ô‡∏π...">
                </div>
                <div class="col-md-6">
                    <select id="categoryFilter" class="form-select">
                        <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</option>
                        <option value="‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ô‡πâ‡∏≥‡∏¢‡πà‡∏≠‡∏¢">‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ô‡πâ‡∏≥‡∏¢‡πà‡∏≠‡∏¢</option>
                        <option value="‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏à‡∏≤‡∏ô‡∏´‡∏•‡∏±‡∏Å">‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏à‡∏≤‡∏ô‡∏´‡∏•‡∏±‡∏Å</option>
                        <option value="‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏Ñ‡∏µ‡∏¢‡∏á">‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏Ñ‡∏µ‡∏¢‡∏á</option>
                        <option value="‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏´‡∏ß‡∏≤‡∏ô">‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏´‡∏ß‡∏≤‡∏ô</option>
                        <option value="‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏î‡∏∑‡πà‡∏°">‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏î‡∏∑‡πà‡∏°</option>
                    </select>
                </div>
            </div>

            <% const groupedMenus={}; Object.values(menus).forEach(item=> {
                if (!groupedMenus[item.category]) groupedMenus[item.category] = [];
                groupedMenus[item.category].push(item);
                });
                const categoryOrder = [
                "‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ô‡πâ‡∏≥‡∏¢‡πà‡∏≠‡∏¢",
                "‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏à‡∏≤‡∏ô‡∏´‡∏•‡∏±‡∏Å",
                "‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏Ñ‡∏µ‡∏¢‡∏á",
                "‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏´‡∏ß‡∏≤‡∏ô",
                "‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏î‡∏∑‡πà‡∏°"
                ];
                categoryOrder.forEach(category => {
                if (groupedMenus[category]) { %>
                <div class="category-section" data-category="<%= category.toLowerCase() %>">
                    <h4><i class="fas fa-folder-open me-2"></i>
                        <%= category %> (<%= groupedMenus[category].length %> ‡πÄ‡∏°‡∏ô‡∏π)
                    </h4>
                    <div class="table-responsive">
                        <table class="table table-bordered table-hover table-striped">
                            <thead>
                                <tr>
                                    <th class="name">‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏°‡∏ô‡∏π</th>
                                    <th class="price">‡∏£‡∏≤‡∏Ñ‡∏≤</th>
                                    <th class="description">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</th>
                                    <th class="category">‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</th>
                                    <th class="image">‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</th>
                                    <th class="status">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                                    <th class="delete">‡∏•‡∏ö</th>
                                    <th class="edit">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</th>
                                </tr>
                            </thead>
                            <tbody>
                                <% groupedMenus[category].forEach(item=> { %>
                                    <tr>
                                        <td class="name">
                                            <%= item.name %>
                                        </td>
                                        <td class="price">
                                            <%= item.price %> ‡∏ö‡∏≤‡∏ó
                                        </td>
                                        <td class="description">
                                            <%= item.description %>
                                        </td>
                                        <td class="category">
                                            <%= item.category %>
                                        </td>
                                        <td class="image">
                                            <img src="./images/menus/<%= item.image %>" alt="<%= item.name %>"
                                                class="img-thumbnail"
                                                style="width: 80px; height: 80px; object-fit: cover;">
                                        </td>
                                        <td class="status">
                                            <button
                                                class="status-btn <%= item.status === 'Active' ? 'btn-active' : 'btn-inactive' %>"
                                                onclick="toggleStatus(this, '<%= item._id %>')">
                                                <%= item.status %>
                                            </button>
                                        </td>
                                        <td class="delete">
                                            <button class="btn btn-sm btn-danger"
                                                onclick="confirmDelete('<%= item._id %>')">‡∏•‡∏ö</button>
                                        </td>
                                        <td class="edit">
                                            <form action="/edit" method="POST">
                                                <input type="hidden" name="id" value="<%= item._id %>">
                                                <button type="submit" class="btn btn-sm btn-warning">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
                                            </form>
                                        </td>
                                    </tr>
                                    <% }) %>
                            </tbody>
                        </table>
                    </div>
                </div>
                <% } }) %>
        </div>

        <script>
            //‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
            async function toggleStatus(button, id) {
                let currentStatus = button.innerText.trim();
                let newStatus = currentStatus === "Active" ? "Inactive" : "Active";
                try {
                    let response = await fetch(`/status/${id}`, {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({ status: newStatus })
                    });
                    if (response.ok) {
                        button.innerText = newStatus;
                        button.classList.toggle("btn-active");
                        button.classList.toggle("btn-inactive");
                    } else {
                        alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞");
                    }
                } catch (error) {
                    console.error("Error:", error);
                }
            }

            function confirmDelete(id) {
                Swal.fire({
                    title: '‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡πÑ‡∏´‡∏°?',
                    text: "‡πÄ‡∏°‡∏ô‡∏π‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏•‡∏ö‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö!",
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#d33',
                    cancelButtonColor: '#6c757d',
                    confirmButtonText: '‡πÉ‡∏ä‡πà, ‡∏•‡∏ö‡πÄ‡∏•‡∏¢!',
                    cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å'
                }).then((result) => {
                    if (result.isConfirmed) {
                        window.location.href = `/delete/${id}`;
                    }
                });
            }

            // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÄ‡∏°‡∏ô‡∏π‡πÅ‡∏•‡∏∞‡∏Å‡∏£‡∏≠‡∏á‡∏ï‡∏≤‡∏°‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà
            function applyFilter() {
                const keyword = document.getElementById("searchInput").value.toLowerCase();
                const selectedCategory = document.getElementById("categoryFilter").value.toLowerCase();
                document.querySelectorAll(".category-section").forEach(section => {
                    const category = section.getAttribute("data-category");
                    const rows = section.querySelectorAll("tbody tr");
                    let hasVisible = false;
                    rows.forEach(row => {
                        const name = row.querySelector(".name").textContent.toLowerCase();
                        const price = row.querySelector(".price").textContent.toLowerCase();
                        const description = row.querySelector(".description").textContent.toLowerCase();
                        const matchesSearch = name.includes(keyword) || price.includes(keyword) || description.includes(keyword);
                        if ((selectedCategory === "" || category === selectedCategory) && matchesSearch) {
                            row.style.display = "";
                            hasVisible = true;
                        } else {
                            row.style.display = "none";
                        }
                    });
                    section.style.display = hasVisible ? "" : "none";
                });
            }

            document.getElementById("searchInput").addEventListener("keyup", applyFilter);
            document.getElementById("categoryFilter").addEventListener("change", applyFilter);
        </script>
</body>

</html>